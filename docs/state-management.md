# 状态管理系统

AutoPilot 使用5个核心JSON状态文件来跟踪完整的项目生命周期。

## 状态文件概览

### REQUIREMENT_ALIGNMENT.json
**用途**：记录需求对齐结果和用户决策
**内容**：
- 用户原始任务描述
- 功能性和非功能性需求
- 用户目标和成功标准
- 技术约束和质量要求
- 用户偏好和预设决策

### EXECUTION_PLAN.json
**用途**：详细执行计划和任务分解
**内容**：
- 完整的TODO任务清单
- 任务依赖关系和执行顺序
- 每个任务的验收标准
- 执行策略和质量门禁
- 风险控制和应急预案

### TODO_TRACKER.json
**用途**：任务进度跟踪和质量指标
**内容**：
- 整体进度统计和百分比
- 每个任务的执行状态
- 质量评分和验收结果
- 时间跟踪和效率分析
- 错误历史和重试次数

### DECISION_LOG.json
**用途**：决策过程记录和分析
**内容**：
- 所有决策的详细信息
- 决策依据和考虑因素
- 决策类型和信心水平
- 偏离规划的决策记录
- 决策模式分析总结

### EXECUTION_STATE.json
**用途**：当前执行状态和会话信息
**内容**：
- 会话信息和执行状态
- 当前任务上下文
- 执行指标和质量数据
- 系统健康和下一步行动
- 上下文管理和刷新记录

## 文件关系

```
REQUIREMENT_ALIGNMENT.json (需求基础)
        ↓
EXECUTION_PLAN.json (执行规划)
        ↓
TODO_TRACKER.json (进度跟踪)
        ↓
DECISION_LOG.json (决策记录)
        ↓
EXECUTION_STATE.json (状态管理)
```

## 状态一致性

### 数据关联
- 所有文件共享相同的 `session_id`
- 时间戳保持逻辑一致性
- 任务状态在多个文件中同步

### 验证机制
- 基于templates/结构定义验证格式
- 检查必需字段和数据类型
- 验证文件间的逻辑关系

### 同步更新
- 任务执行时同步更新多个文件
- 决策记录即时反映到状态文件
- 质量评分实时更新和维护

## 异常处理

### 文件损坏
- 从备份恢复或重新生成
- 基于其他文件推断丢失数据
- 使用结构定义重建框架

### 数据不一致
- 分析不一致原因和影响
- 基于逻辑关系修正数据
- 记录修复过程和依据

### 完整性检查
- 定期验证所有状态文件
- 检查数据完整性和一致性
- 评估系统健康和风险

## 最佳实践

### 文件管理
- 定期备份重要状态文件
- 监控文件大小和性能
- 保持文件格式的一致性

### 数据质量
- 及时更新状态变化
- 保持记录的完整和准确
- 避免重复或冲突信息

### 访问控制
- 仅通过AutoPilot命令修改
- 避免手动直接编辑文件
- 保持操作的可追溯性

详细操作请参考：
- [命令参考](../commands/README.md)
- [恢复机制](recovery-mechanism.md)